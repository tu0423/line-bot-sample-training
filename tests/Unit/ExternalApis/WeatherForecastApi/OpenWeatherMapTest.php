<?php

namespace Tests\Unit\ExternalApis\WeatherForecastApi;

use App\ExternalApis\WeatherForecastApi\OpenWeatherMap;
use PHPUnit\Framework\TestCase;

class OpenWeatherMapTest extends TestCase
{
    /**
     * 受け取ったJSONから天気予報の文字を取得できる
     *
     * @dataProvider parseDataProvider
     *
     * @return void
     */
    public function testParse($expected, $json)
    {
        $openWeatherMap = new OpenWeatherMap('');

        // ※オブジェクトの比較の場合はassertSameを使えない
        $this->assertEquals($openWeatherMap->parse($json), $expected);
    }

    public function parseDataProvider()
    {
        return [
            '正常なJSONの場合、今日(daily[0].weather[0].description)が取れる' => [
                'expected' => '曇りがち',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400,"daily":[{"dt":1613185200,"sunrise":1613166369,"sunset":1613205511,"temp":{"day":288.36,"min":282.66,"max":290.2,"night":285.63,"eve":288.22,"morn":282.71},"feels_like":{"day":286.44,"night":284.17,"eve":285.78,"morn":280.21},"pressure":1026,"humidity":52,"dew_point":278.81,"wind_speed":1.26,"wind_deg":9,"weather":[{"id":803,"main":"Clouds","description":"曇りがち","icon":"04d"}],"clouds":72,"pop":0,"uvi":3.65},{"dt":1613271600,"sunrise":1613252709,"sunset":1613291969,"temp":{"day":288.73,"min":282.49,"max":290.28,"night":286.26,"eve":289,"morn":282.73},"feels_like":{"day":286.64,"night":283.76,"eve":287.08,"morn":280.53},"pressure":1021,"humidity":46,"dew_point":277.29,"wind_speed":1.1,"wind_deg":46,"weather":[{"id":800,"main":"Clear","description":"晴天","icon":"01d"}],"clouds":0,"pop":0.01,"uvi":4.1},{"dt":1613358000,"sunrise":1613339047,"sunset":1613378427,"temp":{"day":286.78,"min":281.53,"max":289.69,"night":281.53,"eve":286.53,"morn":287.22},"feels_like":{"day":283.61,"night":273.03,"eve":278.89,"morn":285.83},"pressure":1000,"humidity":70,"dew_point":281.44,"wind_speed":3.96,"wind_deg":318,"weather":[{"id":502,"main":"Rain","description":"強い雨","icon":"10d"}],"clouds":100,"pop":1,"rain":24,"uvi":2.87},{"dt":1613444400,"sunrise":1613425384,"sunset":1613464885,"temp":{"day":281.66,"min":279.08,"max":283.09,"night":282.87,"eve":283.09,"morn":279.08},"feels_like":{"day":275.05,"night":273.65,"eve":275.66,"morn":273.96},"pressure":1011,"humidity":51,"dew_point":269.26,"wind_speed":6.4,"wind_deg":247,"weather":[{"id":803,"main":"Clouds","description":"曇りがち","icon":"04d"}],"clouds":68,"pop":0.1,"uvi":3.68},{"dt":1613530800,"sunrise":1613511720,"sunset":1613551342,"temp":{"day":276.27,"min":273.68,"max":281.33,"night":273.68,"eve":274.41,"morn":275.47},"feels_like":{"day":266.56,"night":265.13,"eve":265.05,"morn":266.87},"pressure":1009,"humidity":63,"dew_point":261.65,"wind_speed":10.43,"wind_deg":272,"weather":[{"id":616,"main":"Snow","description":"雨と雪","icon":"13d"}],"clouds":100,"pop":0.79,"rain":0.2,"snow":0.17,"uvi":3.32},{"dt":1613617200,"sunrise":1613598054,"sunset":1613637799,"temp":{"day":276.68,"min":273.06,"max":278,"night":275.91,"eve":277.05,"morn":273.06},"feels_like":{"day":268.23,"night":268.69,"eve":269.92,"morn":264.77},"pressure":1011,"humidity":64,"dew_point":263.49,"wind_speed":8.73,"wind_deg":270,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":25,"pop":0.28,"uvi":4},{"dt":1613703600,"sunrise":1613684388,"sunset":1613724256,"temp":{"day":280.39,"min":275.49,"max":282.15,"night":278.99,"eve":280.63,"morn":275.49},"feels_like":{"day":272.9,"night":273.35,"eve":274.19,"morn":270.56},"pressure":1013,"humidity":55,"dew_point":269.21,"wind_speed":7.62,"wind_deg":266,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":49,"pop":0.14,"uvi":4},{"dt":1613790000,"sunrise":1613770721,"sunset":1613810712,"temp":{"day":285.81,"min":278.98,"max":287.13,"night":284.97,"eve":285.83,"morn":279.51},"feels_like":{"day":278.42,"night":280.6,"eve":280.18,"morn":275.92},"pressure":1015,"humidity":54,"dew_point":276.94,"wind_speed":8.57,"wind_deg":241,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":48,"pop":0,"uvi":4}]}',
            ],
            'フォーマットが異なるJSONの場合(dailyが空の場合)' => [
                'expected' => '',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400,"daily":[]}',
            ],
            'フォーマットが異なるJSONの場合(dailyがない場合)' => [
                'expected' => '',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400}',
            ],
            'フォーマットが異なるJSONの場合(weatherがない場合)' => [
                'expected' => '',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400,"daily":[{"dt":1613185200,"sunrise":1613166369,"sunset":1613205511,"temp":{"day":288.36,"min":282.66,"max":290.2,"night":285.63,"eve":288.22,"morn":282.71},"feels_like":{"day":286.44,"night":284.17,"eve":285.78,"morn":280.21},"pressure":1026,"humidity":52,"dew_point":278.81,"wind_speed":1.26,"wind_deg":9,"clouds":72,"pop":0,"uvi":3.65},{"dt":1613271600,"sunrise":1613252709,"sunset":1613291969,"temp":{"day":288.73,"min":282.49,"max":290.28,"night":286.26,"eve":289,"morn":282.73},"feels_like":{"day":286.64,"night":283.76,"eve":287.08,"morn":280.53},"pressure":1021,"humidity":46,"dew_point":277.29,"wind_speed":1.1,"wind_deg":46,"weather":[{"id":800,"main":"Clear","description":"晴天","icon":"01d"}],"clouds":0,"pop":0.01,"uvi":4.1},{"dt":1613358000,"sunrise":1613339047,"sunset":1613378427,"temp":{"day":286.78,"min":281.53,"max":289.69,"night":281.53,"eve":286.53,"morn":287.22},"feels_like":{"day":283.61,"night":273.03,"eve":278.89,"morn":285.83},"pressure":1000,"humidity":70,"dew_point":281.44,"wind_speed":3.96,"wind_deg":318,"weather":[{"id":502,"main":"Rain","description":"強い雨","icon":"10d"}],"clouds":100,"pop":1,"rain":24,"uvi":2.87},{"dt":1613444400,"sunrise":1613425384,"sunset":1613464885,"temp":{"day":281.66,"min":279.08,"max":283.09,"night":282.87,"eve":283.09,"morn":279.08},"feels_like":{"day":275.05,"night":273.65,"eve":275.66,"morn":273.96},"pressure":1011,"humidity":51,"dew_point":269.26,"wind_speed":6.4,"wind_deg":247,"weather":[{"id":803,"main":"Clouds","description":"曇りがち","icon":"04d"}],"clouds":68,"pop":0.1,"uvi":3.68},{"dt":1613530800,"sunrise":1613511720,"sunset":1613551342,"temp":{"day":276.27,"min":273.68,"max":281.33,"night":273.68,"eve":274.41,"morn":275.47},"feels_like":{"day":266.56,"night":265.13,"eve":265.05,"morn":266.87},"pressure":1009,"humidity":63,"dew_point":261.65,"wind_speed":10.43,"wind_deg":272,"weather":[{"id":616,"main":"Snow","description":"雨と雪","icon":"13d"}],"clouds":100,"pop":0.79,"rain":0.2,"snow":0.17,"uvi":3.32},{"dt":1613617200,"sunrise":1613598054,"sunset":1613637799,"temp":{"day":276.68,"min":273.06,"max":278,"night":275.91,"eve":277.05,"morn":273.06},"feels_like":{"day":268.23,"night":268.69,"eve":269.92,"morn":264.77},"pressure":1011,"humidity":64,"dew_point":263.49,"wind_speed":8.73,"wind_deg":270,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":25,"pop":0.28,"uvi":4},{"dt":1613703600,"sunrise":1613684388,"sunset":1613724256,"temp":{"day":280.39,"min":275.49,"max":282.15,"night":278.99,"eve":280.63,"morn":275.49},"feels_like":{"day":272.9,"night":273.35,"eve":274.19,"morn":270.56},"pressure":1013,"humidity":55,"dew_point":269.21,"wind_speed":7.62,"wind_deg":266,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":49,"pop":0.14,"uvi":4},{"dt":1613790000,"sunrise":1613770721,"sunset":1613810712,"temp":{"day":285.81,"min":278.98,"max":287.13,"night":284.97,"eve":285.83,"morn":279.51},"feels_like":{"day":278.42,"night":280.6,"eve":280.18,"morn":275.92},"pressure":1015,"humidity":54,"dew_point":276.94,"wind_speed":8.57,"wind_deg":241,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":48,"pop":0,"uvi":4}]}',
            ],
            'フォーマットが異なるJSONの場合(weatherが空の場合)' => [
                'expected' => '',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400,"daily":[{"dt":1613185200,"sunrise":1613166369,"sunset":1613205511,"temp":{"day":288.36,"min":282.66,"max":290.2,"night":285.63,"eve":288.22,"morn":282.71},"feels_like":{"day":286.44,"night":284.17,"eve":285.78,"morn":280.21},"pressure":1026,"humidity":52,"dew_point":278.81,"wind_speed":1.26,"wind_deg":9,"weather":[],"clouds":72,"pop":0,"uvi":3.65},{"dt":1613271600,"sunrise":1613252709,"sunset":1613291969,"temp":{"day":288.73,"min":282.49,"max":290.28,"night":286.26,"eve":289,"morn":282.73},"feels_like":{"day":286.64,"night":283.76,"eve":287.08,"morn":280.53},"pressure":1021,"humidity":46,"dew_point":277.29,"wind_speed":1.1,"wind_deg":46,"weather":[{"id":800,"main":"Clear","description":"晴天","icon":"01d"}],"clouds":0,"pop":0.01,"uvi":4.1},{"dt":1613358000,"sunrise":1613339047,"sunset":1613378427,"temp":{"day":286.78,"min":281.53,"max":289.69,"night":281.53,"eve":286.53,"morn":287.22},"feels_like":{"day":283.61,"night":273.03,"eve":278.89,"morn":285.83},"pressure":1000,"humidity":70,"dew_point":281.44,"wind_speed":3.96,"wind_deg":318,"weather":[{"id":502,"main":"Rain","description":"強い雨","icon":"10d"}],"clouds":100,"pop":1,"rain":24,"uvi":2.87},{"dt":1613444400,"sunrise":1613425384,"sunset":1613464885,"temp":{"day":281.66,"min":279.08,"max":283.09,"night":282.87,"eve":283.09,"morn":279.08},"feels_like":{"day":275.05,"night":273.65,"eve":275.66,"morn":273.96},"pressure":1011,"humidity":51,"dew_point":269.26,"wind_speed":6.4,"wind_deg":247,"weather":[{"id":803,"main":"Clouds","description":"曇りがち","icon":"04d"}],"clouds":68,"pop":0.1,"uvi":3.68},{"dt":1613530800,"sunrise":1613511720,"sunset":1613551342,"temp":{"day":276.27,"min":273.68,"max":281.33,"night":273.68,"eve":274.41,"morn":275.47},"feels_like":{"day":266.56,"night":265.13,"eve":265.05,"morn":266.87},"pressure":1009,"humidity":63,"dew_point":261.65,"wind_speed":10.43,"wind_deg":272,"weather":[{"id":616,"main":"Snow","description":"雨と雪","icon":"13d"}],"clouds":100,"pop":0.79,"rain":0.2,"snow":0.17,"uvi":3.32},{"dt":1613617200,"sunrise":1613598054,"sunset":1613637799,"temp":{"day":276.68,"min":273.06,"max":278,"night":275.91,"eve":277.05,"morn":273.06},"feels_like":{"day":268.23,"night":268.69,"eve":269.92,"morn":264.77},"pressure":1011,"humidity":64,"dew_point":263.49,"wind_speed":8.73,"wind_deg":270,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":25,"pop":0.28,"uvi":4},{"dt":1613703600,"sunrise":1613684388,"sunset":1613724256,"temp":{"day":280.39,"min":275.49,"max":282.15,"night":278.99,"eve":280.63,"morn":275.49},"feels_like":{"day":272.9,"night":273.35,"eve":274.19,"morn":270.56},"pressure":1013,"humidity":55,"dew_point":269.21,"wind_speed":7.62,"wind_deg":266,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":49,"pop":0.14,"uvi":4},{"dt":1613790000,"sunrise":1613770721,"sunset":1613810712,"temp":{"day":285.81,"min":278.98,"max":287.13,"night":284.97,"eve":285.83,"morn":279.51},"feels_like":{"day":278.42,"night":280.6,"eve":280.18,"morn":275.92},"pressure":1015,"humidity":54,"dew_point":276.94,"wind_speed":8.57,"wind_deg":241,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":48,"pop":0,"uvi":4}]}',
            ],
            'フォーマットが異なるJSONの場合(descriptionがない場合)' => [
                'expected' => '',
                'JSON' => '{"lat":34.7037,"lon":135.4963,"timezone":"Asia/Tokyo","timezone_offset":32400,"daily":[{"dt":1613185200,"sunrise":1613166369,"sunset":1613205511,"temp":{"day":288.36,"min":282.66,"max":290.2,"night":285.63,"eve":288.22,"morn":282.71},"feels_like":{"day":286.44,"night":284.17,"eve":285.78,"morn":280.21},"pressure":1026,"humidity":52,"dew_point":278.81,"wind_speed":1.26,"wind_deg":9,"weather":[{"id":803,"main":"Clouds","icon":"04d"}],"clouds":72,"pop":0,"uvi":3.65},{"dt":1613271600,"sunrise":1613252709,"sunset":1613291969,"temp":{"day":288.73,"min":282.49,"max":290.28,"night":286.26,"eve":289,"morn":282.73},"feels_like":{"day":286.64,"night":283.76,"eve":287.08,"morn":280.53},"pressure":1021,"humidity":46,"dew_point":277.29,"wind_speed":1.1,"wind_deg":46,"weather":[{"id":800,"main":"Clear","description":"晴天","icon":"01d"}],"clouds":0,"pop":0.01,"uvi":4.1},{"dt":1613358000,"sunrise":1613339047,"sunset":1613378427,"temp":{"day":286.78,"min":281.53,"max":289.69,"night":281.53,"eve":286.53,"morn":287.22},"feels_like":{"day":283.61,"night":273.03,"eve":278.89,"morn":285.83},"pressure":1000,"humidity":70,"dew_point":281.44,"wind_speed":3.96,"wind_deg":318,"weather":[{"id":502,"main":"Rain","description":"強い雨","icon":"10d"}],"clouds":100,"pop":1,"rain":24,"uvi":2.87},{"dt":1613444400,"sunrise":1613425384,"sunset":1613464885,"temp":{"day":281.66,"min":279.08,"max":283.09,"night":282.87,"eve":283.09,"morn":279.08},"feels_like":{"day":275.05,"night":273.65,"eve":275.66,"morn":273.96},"pressure":1011,"humidity":51,"dew_point":269.26,"wind_speed":6.4,"wind_deg":247,"weather":[{"id":803,"main":"Clouds","description":"曇りがち","icon":"04d"}],"clouds":68,"pop":0.1,"uvi":3.68},{"dt":1613530800,"sunrise":1613511720,"sunset":1613551342,"temp":{"day":276.27,"min":273.68,"max":281.33,"night":273.68,"eve":274.41,"morn":275.47},"feels_like":{"day":266.56,"night":265.13,"eve":265.05,"morn":266.87},"pressure":1009,"humidity":63,"dew_point":261.65,"wind_speed":10.43,"wind_deg":272,"weather":[{"id":616,"main":"Snow","description":"雨と雪","icon":"13d"}],"clouds":100,"pop":0.79,"rain":0.2,"snow":0.17,"uvi":3.32},{"dt":1613617200,"sunrise":1613598054,"sunset":1613637799,"temp":{"day":276.68,"min":273.06,"max":278,"night":275.91,"eve":277.05,"morn":273.06},"feels_like":{"day":268.23,"night":268.69,"eve":269.92,"morn":264.77},"pressure":1011,"humidity":64,"dew_point":263.49,"wind_speed":8.73,"wind_deg":270,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":25,"pop":0.28,"uvi":4},{"dt":1613703600,"sunrise":1613684388,"sunset":1613724256,"temp":{"day":280.39,"min":275.49,"max":282.15,"night":278.99,"eve":280.63,"morn":275.49},"feels_like":{"day":272.9,"night":273.35,"eve":274.19,"morn":270.56},"pressure":1013,"humidity":55,"dew_point":269.21,"wind_speed":7.62,"wind_deg":266,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":49,"pop":0.14,"uvi":4},{"dt":1613790000,"sunrise":1613770721,"sunset":1613810712,"temp":{"day":285.81,"min":278.98,"max":287.13,"night":284.97,"eve":285.83,"morn":279.51},"feels_like":{"day":278.42,"night":280.6,"eve":280.18,"morn":275.92},"pressure":1015,"humidity":54,"dew_point":276.94,"wind_speed":8.57,"wind_deg":241,"weather":[{"id":802,"main":"Clouds","description":"雲","icon":"03d"}],"clouds":48,"pop":0,"uvi":4}]}',
            ],
        ];
    }
}
